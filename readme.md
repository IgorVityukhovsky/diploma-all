![Скриншот](https://i.ibb.co/Y39DxSL/Screenshot-2023-09-19-184811.png)  
![Скриншот](https://i.ibb.co/hCG4rGG/image.png)  
[Репозиторий с terraform](https://github.com/IgorVityukhovsky/diploma-terraform)  
[Репозиторий с dockerfile](https://github.com/IgorVityukhovsky/diploma-docker)  
[Докерхаб с образом приложения](https://hub.docker.com/repository/docker/igorvit/diploma/general)  
[Тестовое приложение](http://diploma-netology-igorv.site:30000/index.html)  
[Grafana](http://diploma-netology-igorv.site:30000/login)  
Данные для входа в графана:  
admin  
prom-operator  

## Подробности выполнения  
- Нет отдельного репозитория для кубера, так как все манифесты создаются с помощью шаблонов терраформ и сразу пробрасываются на машины, т.е. все манифесты кубера находятся в репозитории terraform.  
- Для настройки кубера использовался кубспрей, отдельного репозитория для ansible нет, так как использовал стандартный.  
- Терраформ создаёт подсети, машины, для двух машин создаёт статический IP один и тот же, что бы при переразворачивании кластера он сохранялся.  
- После поднятия инфраструктуры терраформ кладёт на мастер машину всё необходимое.
- Можно было бы автоматизировать все запуски, но для отладки оставил полуавтоматический режим, т.е. терраформом создаётся только инфраструктура.  
- Далее терраформ копирует сгенерированные манифесты и скрипты.  
- Один из них выполняет всю необходимую подготовку для работы кубспрея и разворачивает кластер, второй деплоит все необходимые приложения и сервисы.  
- Все секреты хранятся в виде переменных в Terraform Cloud и переопределяются им при выполнении манифестов.  
- Сервис jenkins выполняет всё необходимое по ДЗ, а так же все его файлы хранятся на PV и подтягиваются с помощью PVC, таким образом даже если переразвернуть кластер, то все билды и настройки останутся на месте.  
- Это важно, так как в jenkinsfile версионирование осуществляется с помощью тага на гитхабе и номера сборки в jenkins.  
- Для организации доступа из вне используется nginx ingress controller, нод порты (хотя можно было бы орагнизовать с помощью типа сети host), так же арендованы DNS что бы из браузера запрос проходил с заголовками, к которым в свою очередь применяются ingress правила маршрутизации по сервисам.
